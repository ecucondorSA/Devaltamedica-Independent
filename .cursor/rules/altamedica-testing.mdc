# ğŸ§ª AltaMedica Testing - GuÃ­a Completa

## ğŸ¯ Estrategia de Testing

### ğŸ—ï¸ PirÃ¡mide de Testing
- **70% Tests Unitarios** - LÃ³gica de negocio y componentes
- **20% Tests de IntegraciÃ³n** - APIs y servicios
- **10% Tests E2E** - Flujos crÃ­ticos del usuario

### ğŸ¯ Cobertura Objetivos
- **Cobertura mÃ­nima**: 80% para cÃ³digo crÃ­tico
- **Cobertura objetivo**: 90% para packages compartidos
- **Cobertura crÃ­tica**: 95% para funcionalidades mÃ©dicas

## ğŸ§ª Tipos de Tests

### ğŸ§ª Tests Unitarios
- **Framework**: Vitest
- **Scope**: Funciones individuales, componentes
- **Mocks**: Dependencias externas, APIs
- **EjecuciÃ³n**: RÃ¡pida (< 100ms por test)

### ğŸ§ª Tests de IntegraciÃ³n
- **Framework**: Vitest + Supertest
- **Scope**: APIs, servicios, base de datos
- **Base de datos**: Testing DB separada
- **Cleanup**: AutomÃ¡tico entre tests

### ğŸ§ª Tests E2E
- **Framework**: Playwright (principal), Cypress
- **Scope**: Flujos completos de usuario
- **Browser**: Chrome, Firefox, Safari
- **Performance**: MÃ©tricas de Core Web Vitals

### ğŸ§ª Tests Especializados
- **Tests HIPAA**: Compliance y seguridad
- **Tests de Accesibilidad**: WCAG 2.1 AA
- **Tests de Performance**: Lighthouse, Web Vitals
- **Tests de Seguridad**: OWASP Top 10

## ğŸ› ï¸ ConfiguraciÃ³n de Testing

### âš™ï¸ Vitest (Unit + Integration)
```typescript
// vitest.config.ts
export default defineConfig({
  test: {
    environment: 'jsdom',
    setupFiles: ['./src/test/setup.ts'],
    coverage: {
      provider: 'v8',
      reporter: ['text', 'json', 'html'],
      thresholds: {
        global: {
          branches: 80,
          functions: 80,
          lines: 80,
          statements: 80
        }
      }
    }
  }
})
```

### âš™ï¸ Playwright (E2E)
```typescript
// playwright.config.ts
export default defineConfig({
  testDir: './e2e',
  use: {
    baseURL: process.env.E2E_BASE_URL || 'http://localhost:3000',
    screenshot: 'only-on-failure',
    video: 'retain-on-failure'
  },
  projects: [
    { name: 'Chrome', use: { browserName: 'chromium' } },
    { name: 'Firefox', use: { browserName: 'firefox' } },
    { name: 'Safari', use: { browserName: 'webkit' } }
  ]
})
```

## ğŸ“ Patrones de Testing

### ğŸ§ª Testing de Componentes React
```typescript
// Component.test.tsx
import { render, screen } from '@testing-library/react'
import { describe, it, expect } from 'vitest'
import { Component } from './Component'

describe('Component', () => {
  it('should render correctly', () => {
    render(<Component />)
    expect(screen.getByText('Hello')).toBeInTheDocument()
  })
})
```

### ğŸ§ª Testing de APIs
```typescript
// api.test.ts
import request from 'supertest'
import { app } from '../src/app'
import { describe, it, expect } from 'vitest'

describe('API Endpoints', () => {
  it('GET /api/health should return 200', async () => {
    const response = await request(app).get('/api/health')
    expect(response.status).toBe(200)
  })
})
```

### ğŸ§ª Testing de Base de Datos
```typescript
// database.test.ts
import { PrismaClient } from '@prisma/client'
import { describe, it, expect, beforeEach, afterEach } from 'vitest'

const prisma = new PrismaClient()

describe('Database Operations', () => {
  beforeEach(async () => {
    // Setup test data
  })

  afterEach(async () => {
    // Cleanup test data
  })

  it('should create user', async () => {
    const user = await prisma.user.create({
      data: { email: 'test@example.com' }
    })
    expect(user.email).toBe('test@example.com')
  })
})
```

## ğŸš€ CI/CD Integration

### ğŸ”„ GitHub Actions
- **Tests unitarios** en cada PR
- **Tests de integraciÃ³n** en merge a develop
- **Tests E2E** en deploy a staging
- **Tests completos** en deploy a production

### ğŸ“Š Reportes
- **Coverage reports** con Codecov
- **Test results** en GitHub Actions
- **Performance metrics** con Lighthouse CI
- **Security scans** con CodeQL

## ğŸ¯ Testing de Funcionalidades MÃ©dicas

### ğŸ¥ Compliance HIPAA
- **EncriptaciÃ³n** de datos sensibles
- **Audit logging** de accesos
- **Timeouts** de sesiÃ³n
- **ValidaciÃ³n** de permisos

### ğŸ§¬ Datos MÃ©dicos
- **AnonimizaciÃ³n** en tests
- **Mock data** realista pero seguro
- **ValidaciÃ³n** de esquemas mÃ©dicos
- **Tests de edge cases** crÃ­ticos
description:
globs:
alwaysApply: false
---
