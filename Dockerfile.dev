# Development Dockerfile with hot reload
FROM node:20-alpine

# Install dependencies for building native modules
RUN apk add --no-cache \
    python3 \
    make \
    g++ \
    libc6-compat \
    git

WORKDIR /app

# Enable pnpm
RUN corepack enable pnpm
RUN pnpm config set store-dir /app/.pnpm-store

# Copy package files
COPY package.json pnpm-lock.yaml pnpm-workspace.yaml ./
COPY packages/*/package.json ./packages/*/
COPY apps/*/package.json ./apps/*/

# Install dependencies
RUN pnpm install --frozen-lockfile

# Copy source code
COPY . .

# Expose all development ports
EXPOSE 3000 3001 3002 8888 9090 3003

# Development command
CMD ["pnpm", "run", "dev"]